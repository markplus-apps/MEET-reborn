generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("VPS_DATABASE_URL")
}

enum Role {
  EMPLOYEE
  ADMIN
  SUPER_ADMIN
}

enum RoomCategory {
  PUBLIC
  SPECIAL
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum CheckInStatus {
  PENDING
  CHECKED_IN
  MISSED
}

model User {
  id               String    @id @default(cuid())
  name             String
  email            String    @unique
  password         String
  role             Role      @default(EMPLOYEE)
  avatar           String?
  image            String?
  status           String?
  bio              String?
  googleSheetRowId String?
  createdAt        DateTime  @default(now())
  bookings         Booking[] @relation("userBookings")
  modifiedBookings Booking[] @relation("modifiedBookings")

  @@map("users")
}

model Room {
  id         String       @id @default(cuid())
  name       String
  category   RoomCategory
  capacity   Int
  facilities String[]
  imageUrl   String?
  isActive   Boolean      @default(true)
  bookings   Booking[]

  @@map("rooms")
}

model Booking {
  id               String        @id @default(cuid())
  startTime        DateTime
  endTime          DateTime
  title            String
  description      String?
  participantCount Int           @default(1)
  checkInStatus    CheckInStatus @default(PENDING)
  googleSheetRowId String?
  userId           String
  roomId           String
  status           BookingStatus @default(CONFIRMED)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime?     @updatedAt
  lastModifiedById String?
  lastAction       String?
  lastActionAt     DateTime?

  user             User @relation("userBookings", fields: [userId], references: [id], onDelete: Cascade)
  room             Room @relation(fields: [roomId], references: [id], onDelete: Cascade)
  lastModifiedBy   User? @relation("modifiedBookings", fields: [lastModifiedById], references: [id], onDelete: SetNull)

  @@map("bookings")
}
